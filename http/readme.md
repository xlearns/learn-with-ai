# 总结

## http0.9
- 只能发送get
- 不能发送header
- 无cookie

## http1

## http2
- 二进制分帧，header 和 data 分离
- 多路复用，使用多个 steam，每个stream又分帧传输，使得一个TCP可以处理多个http请求
- 头部压缩，两端维护一个 header索引，通过key匹配
- 服务器推送【PUSH_PROMISE帧】

## http3

## tcp

### 字节流传输
### tcp粘包问题

### tcp的缺点

## 多路复用【多个数据流共享一条连接】
- 在传输过程中，多个独立的数据流被拆分成小的数据包，然后交错地发送到目标设备，最后再组合成完整的数据流。这种技术能够大大提高数据传输效率和带宽利用率，并减少数据传输时延。
- 优点：
  - 提高带宽利用率：多路复用可以将多个数据流同时传输，从而有效提高了网络带宽的利用率。
  - 减少数据传输时延：相比较于单路复用，多路复用能够将多个数据流同时传输，因此可以减少传输时延，提高网络传输速度。
  - 降低系统开销：多路复用可以让多个应用程序共享同一条连接，降低了系统开销。
  - 支持长连接：多路复用可以支持长连接，这样避免了频繁地建立、断开连接，降低了系统资源开销和网络负载。
- 缺点：
  - 实现复杂：多路复用需要对数据流进行拆分、交错和重组等操作，实现起来比较复杂。
  - 安全性难以保证：多路复用中的所有数据流共享同一条连接，如果不采取相应的安全措施，容易导致数据泄露和攻击。
  - 可靠性较低：由于多路复用中多个数据流共享同一条连接，一旦该连接出现故障，就会影响所有的数据流。因此，可靠性较低。

## http2 中 server push 与 websocket 与 有什么区别
- HTTP/2虽然支持服务器推送资源到客户端，但这种机制不能像WebSocket一样建立双向实时通信。HTTP/2服务器推送机制是通过PUSH_PROMISE帧来完成的，该帧允许服务器在响应请求时向客户端发送额外的资源，从而减少客户端需要发起的请求数量，以及缩短请求响应时间。但这些资源并不会像WebSocket那样建立一个持久化的双向通信连接，因此无法实现实时通信。
  - PUSH_PROMISE帧是HTTP/2协议中的一种帧类型，用于服务器主动向客户端推送资源。在HTTP/2中，客户端请求一个资源时，服务器可以提前将该资源依赖的其他资源一并推送给客户端，从而缩短页面加载时间。PUSH_PROMISE帧包含了被推送资源的相关信息，如资源的ID、路径等，并被发送到客户端。客户端收到PUSH_PROMISE帧后，会创建一个新的流（Stream）来接收这些被推送的资源。

### sse
- 是一种基于 HTTP 的服务器推送技术，它允许服务器持续地向客户端发送数据并自动更新页面，而无需客户端发起任何请求。SSE 是 HTML5 规范中的一部分，它使用了标准的 HTTP 协议来实现服务器和客户端之间的通信。与传统的 Ajax 和长轮询技术不同，SSE 建立在 HTTP 1.1 协议的基础上，通过利用 HTTP 头部信息和 chunked 编码来实现数据的实时推送。当客户端与服务器建立 SSE 连接后，服务器会保持连接打开状态，并定期发送消息到客户端。客户端可以通过监听 onmessage 事件来处理服务器推送的数据，在收到新的消息后，客户端可以使用 JavaScript 动态更新页面内容。
SSE 使用了一个特殊的 MIME 类型 text/event-stream，表示服务器会向客户端推送文本类型的事件流

#### sse是如何保证连接一直打开状态
- SSE 依赖于 HTTP 1.1 协议的持久连接（persistent connection）特性来保持连接状态，从而允许服务器向客户端发送数据。在 SSE 中，客户端通过向服务器发起一个普通的 GET 请求来建立与服务器之间的连接。服务器接收到该请求后返回一个带有 "Content-Type: text/event-stream" 的响应，表示服务器将会以流式的方式向客户端发送数据。
一旦连接建立成功，服务器便开始向客户端推送数据，每次推送的数据都使用一系列预定义的格式进行封装，例如：
  ```
  event: message
  data: Hello, World!\n\n
  ```
  其中 "event" 表示当前推送的消息类型，"data" 表示消息的内容。每个消息需要以两个连续的换行符作为结尾，以告知客户端这是一个完整的消息。当服务器没有新数据可用时，它仍然会向客户端发送空数据包（即只包含两个换行符的数据包），以确保连接保持打开状态。此外，在长时间没有传输数据的情况下，服务器和客户端之间可能存在某些中间设备（如路由器、代理服务器等）会自动关闭空闲连接，为了防止连接被意外关闭，SSE 规范中还规定了客户端必须定期向服务器发送一个类似于“心跳”的数据包，以保持连接的稳定性。通过以上方式，SSE 能够在客户端与服务器之间建立一个长期的、异步的单向通信通道，从而使得服务器可以随时向客户端推送数据，且保持连接处于打开状态。

## 服务端如何知道本次的协议是 WebSocket 呢?
- 通过请求头
  - Connection: Upgrade
  - Upgrade: websocket
  - Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
  - Sec-WebSocket-Version: 13

## 为什么是三次握⼿？不是两次或者四次？
